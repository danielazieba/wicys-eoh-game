<!DOCTYPE html>
<html>
<head>
<meta charset = "utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cybersecurity Breakfast Adventure</title>
<style>
  /* style for entire webpage */
  body {
    background-color: black;
    text-align: center;
    color: white;
    font-family: courier;
  }

  /* style for guide hyperlinks */
  a
  {
    color: rgb(123, 213, 255);
  }

/* this part of the code makes the canvas only show at the top of the page--cannot position it */
/* canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
} */
</style>
<!-- <link rel="stylesheet" href="css/alt.css"> -->
</head>
  <h2>Cybersecurity Breakfast Adventure</h2>
  <h3>*For the best user experience, please use Mozilla Firefox. The game has experienced some issues in Google Chrome and Safari. If you ever have problems of the character getting stuck in place or the screen going black, please refresh the page. Note that your current progress in the game will be lost when the page is refreshed.*</h3>
<p>Instructions: Use the arrow keys to navigate locations and complete your tasks. If you find yourself at a pop-up screen within the game, press Escape to close it and return to the overworld. For text-based prompts, hit Enter to submit your input.</p>
<!-- creating a canvas: -->
<canvas id="myCanvas" width="700" height="500" style="background-color: #f1f1f1;"></canvas>
<!-- <script src="plugins.js"></script> -->
<br>
<!-- <body onload="startGame()"> -->
<body onload="start()">
<script>
  // get the canvas element and context (context allows you to draw on the canvas)
  const game_canvas = document.getElementById("myCanvas");
  const game_context = game_canvas.getContext("2d");


  /* SCENE ATTRIBUTES */
  // the following grouped variables store pics of the game scenes
  var bedroom_scene;
  var kitchen_scene;
  var livingroom_scene;

  // the following grouped variables store pics of zoomed in objects
  var whiteboard_scene;
  var computer_scene;
  var combo_lock_scene;


  var is_bedroom_scene = true;
  var is_kitchen_scene = false;
  var is_livingroom_scene = false;

  var is_whiteboard_scene = false;
  var is_computer_scene = false;
  var is_combo_lock_scene = false;


  var scene_pic;  // current background picture being displayed
  var current_room;  // current room the user is in (i.e. bedroom, kitchen, etc)


  /* CHARACTER ATTRIBUTES */
  var char_right1;  // stores pic of character facing right, step 1
  var char_right2;  // stores pic of character facing right, step 2
  var char_left1;  // stores pic of character facing left, step 1
  var char_left2;  // stores pic of character facing left, step 2

  // used to determine what direction and step the
  // current character image being displayed is
  var is_right1 = false;
  var is_right2 = false;
  var is_left1 = true;
  var is_left2 = false;

  var char_pic;  // current character picture being displayed

  var char_x_pos = 587;  // x pos of top left corner of char img
  var char_y_pos = 282;  // y pos of top left corner of char img

  const char_speed = 3;

  var step_counter = 0;  // used to determine whether the character step changes
  var step_change = 25;  // every 25 ms, character step changes

  // boolean variables representing if the specific arrow key is being pressed by user
  var is_key_up = false;
  var is_key_right = false;
  var is_key_down = false;
  var is_key_left = false;


  /* INTERACTIVE ATTRIBUTES (mostly bounds to interact with zoom-in items) */
  // bedroom whiteboard
  const whiteboard_left_bound = 267;
  const whiteboard_right_bound = 380;
  const whiteboard_bottom_bound = 117;

  // living room computer
  const computer_left_bound = 567;
  const computer_right_bound = 635;
  const computer_bottom_bound = 347;
  const computer_top_bound = 197;

  // kitchen combo lock
  const combo_lock_left_bound = 20;
  const combo_lock_right_bound = 75;
  const combo_lock_bottom_bound = 235;
  const combo_lock_top_bound = 180;




  // FINAL ATTEMPT (SUCCESSFUL!!)
  console.log("BEGIN");

  // begins game
  function start() {
    console.log("starting")

    // load initial game setting components
    bedroom_scene = loadBackground("images/bedroom.png");
    kitchen_scene = loadBackground("images/new_new_kitchen.png");
    livingroom_scene = loadBackground("images/big-out-living.png");

    // zoomed in images
    whiteboard_scene = loadBackground("images/whiteboard_w_lock_clue.png")
    computer_scene = loadBackground("images/locked_computer.png")
    combo_lock_scene = loadBackground("images/combination_lock_with_numbers_on_cabinet_w_box1.png")

    // load initial character components
    char_right1 = loadCharacter("images/step1.png", char_x_pos, char_y_pos, 64, 64);
    char_right2 = loadCharacter("images/step2.png", char_x_pos, char_y_pos, 64, 64);
    char_left1 = loadCharacter("images/step1_left.png", char_x_pos, char_y_pos, 64, 64);
    char_left2 = loadCharacter("images/step2_left.png", char_x_pos, char_y_pos, 64, 64);
    
    // initialize values
    scene_pic = bedroom_scene;
    current_room = bedroom_scene;
    char_pic = char_left1;

    setInterval(update, 20)  // infinite loop, runs every 2 ms

    console.log("ending")
  }


  // updates game visuals and stats
  function update() {
    // step 1 - clear the canvas
    clearCanvas();

    // step 2 - update character position + scene
    moveCharacter();
    step_counter++;

    zoomInOnItem();

    // update game scene by switching between rooms
    changeRooms();

    // step 3 - redraw
    draw(scene_pic, 0, 0, 700, 500);
    if (scene_pic == bedroom_scene || scene_pic == kitchen_scene || scene_pic == livingroom_scene) {  // only draw character if in a room
      draw(char_pic, char_x_pos, char_y_pos, 64, 64);
    }

    // can use to find current position of character
    console.log("x: " + char_x_pos);
    console.log("y: " + char_y_pos);

    console.log("CLEARED")
  }


  // clears canvas
  function clearCanvas() {
    // clears everything on the canvas
    game_context.clearRect(0, 0, 700, 500);
  }


  // moves character
  function moveCharacter() {
    //only allow to move the character when it is in a room
    if (scene_pic == bedroom_scene || scene_pic == kitchen_scene || scene_pic == livingroom_scene) {  
      if (is_key_up && (char_y_pos - char_speed >= 0) && (char_y_pos - char_speed <= 436)) {
        char_y_pos -= char_speed;

        changeSteps(false, false, false);
      }

      // move right
      if (is_key_right && (char_x_pos + char_speed >= 0) && (char_x_pos + char_speed <= 636)) {
        char_x_pos += char_speed;

        changeSteps(true, false, (char_pic == char_left1 || char_pic == char_left2));
      }

      // move down
      if (is_key_down && (char_y_pos + char_speed >= 0) && (char_y_pos + char_speed <= 436)) {
        char_y_pos += char_speed;

        changeSteps(false, false, false);
      }

      // move left
      if (is_key_left && (char_x_pos - char_speed >= 0) && (char_x_pos - char_speed <= 636)) {
        char_x_pos -= char_speed;

        changeSteps(false, true, (char_pic == char_right1 || char_pic == char_right2));
      }
    }
  }


  /**
   * Changes the steps of the character to create an animation of the character walking.
   * 
   * @param is_moving_right Boolean representing if the user wants to move the character right
   * @param is_moving_left Boolean representing if the user wants to move the character left
   * @param is_changing Boolean that's true if the character is changing directions horizontally
   *   (i.e. if the character is moving from right to left or vice versa)
   */
  function changeSteps(is_moving_right, is_moving_left, is_changing) {
    // determine if steps are changed
    if (step_counter % step_change == 0 || is_changing) {
      if (!is_moving_right && !is_moving_left) {  // i.e. moving up or down
        if (is_right1) {
          // change char pic
          char_pic = char_right2;
          
          is_right2 = true;
          is_right1 = false;
        } else if (is_right2) {
          // change char pic
          char_pic = char_right1;

          is_right1 = true;
          is_right2 = false;
        } else if (is_left1) {
          // change char pic
          char_pic = char_left2;

          is_left2 = true;
          is_left1 = false;
        } else if (is_left2) {
          // change char pic
          char_pic = char_left1;

          is_left1 = true;
          is_left2 = false;
        }
      } else if (is_moving_right && !is_moving_left) {
        if (is_right1) {
          // change char pic
          char_pic = char_right2;
          
          is_right2 = true;
          is_right1 = false;
        } else if (is_right2) {
          // change char pic
          char_pic = char_right1;

          is_right1 = true;
          is_right2 = false;
        } else {
          // change char pic
          char_pic = char_right1;

          is_right1 = true;
          is_left1 = false;
          is_left2 = false;
        }
      } else if (is_moving_left && !is_moving_right) {
        if (is_left1) {
          // change char pic
          char_pic = char_left2;
          
          is_left2 = true;
          is_left1 = false;
        } else if (is_left2) {
          // change char pic
          char_pic = char_left1;

          is_left1 = true;
          is_left2 = false;
        } else {
          // change char pic
          char_pic = char_left1;

          is_left1 = true;
          is_right1 = false;
          is_right2 = false;
        }
      }
    }
  }


  // check if the character landed in any zoom in area
  function zoomInOnItem() {
    if (scene_pic == bedroom_scene && char_x_pos >= whiteboard_left_bound &&
      char_x_pos <= whiteboard_right_bound && char_y_pos <= whiteboard_bottom_bound) {
        // zoom into whiteboard
        scene_pic = whiteboard_scene;

        // update values
        is_whiteboard_scene = true;
        is_bedroom_scene = false;
    }

    if (scene_pic == livingroom_scene && char_x_pos >= computer_left_bound && 
      char_x_pos <= computer_right_bound && char_y_pos <= computer_bottom_bound &&
      char_y_pos >= computer_top_bound) {
      
      scene_pic = computer_scene;
      is_computer_scene = true;
      is_livingroom_scene = false;

    }

    if (scene_pic == kitchen_scene && char_x_pos >= combo_lock_left_bound &&
      char_x_pos <= combo_lock_right_bound && char_y_pos <= combo_lock_bottom_bound &&
      char_y_pos >= combo_lock_top_bound) {
        
        scene_pic = combo_lock_scene
        is_combo_lock_scene = true;
        is_kitchen_scene = false;

      }
  }


  /* RECORD KEY DOWNS (specifically character movements) */
  // source: https://stackoverflow.com/questions/39806858/how-to-use-arrow-keys-to-move-object-smoothly-in-canvas
  document.onkeydown = function(event) {
    if (event.code === "ArrowUp") {
      is_key_up = true;
    }

    if (event.code === "ArrowRight") {
      is_key_right = true;
    }

    if (event.code === "ArrowDown") {
      is_key_down = true;
    }

    if (event.code === "ArrowLeft") {
      is_key_left = true;
    }
  }

  document.onkeyup = function(event) {
    if (event.code === "ArrowUp") {
      is_key_up = false;
    }

    if (event.code === "ArrowRight") {
      is_key_right = false;
    }

    if (event.code === "ArrowDown") {
      is_key_down = false;
    }

    if (event.code === "ArrowLeft") {
      is_key_left = false;
    }
  }


  /* RECORD KEY DOWNS (i.e. for closing windows, hints, etc) */
  // special key down - escape the zoomed in window, hints etc
  document.addEventListener('keydown', logKey)

  function logKey(key) {
    
    if (key.code === "Escape") {
      if (is_whiteboard_scene) {
        // zoom out of whiteboard
        scene_pic = current_room;
        
        // need the following to prevent the character from triggering the zoom in again
        moveOutOfDetectionZone(whiteboard_left_bound, whiteboard_right_bound, whiteboard_bottom_bound);

        // update values
        is_whiteboard_scene = false;
        if (current_room === bedroom_scene) {
          is_bedroom_scene = true;
        }
      }

      if (is_computer_scene) {  
        // zoom out of computer
        scene_pic = current_room;

        // move out of the zone that triggered zoom in
        moveOutOfDetectionZone(computer_left_bound, computer_right_bound, computer_bottom_bound);

        // update values of the game scene
        is_computer_scene = false;
        if (current_room === livingroom_scene) {
          is_livingroom_scene = true;
        }
      }

      if (is_combo_lock_scene) {
        // zoom out of combo lock
        scene_pic = current_room;

        // move out of the zone that triggered zoom in
        moveOutOfDetectionZone(combo_lock_left_bound, combo_lock_right_bound, combo_lock_bottom_bound);

        // update values
        is_combo_lock_scene = false;
        if (current_room === kitchen_scene) {
          is_kitchen_scene = true;
        }
      }
    }  // closing the escape key conditional  
  }  // closing log key function


  // moves the character out of the area that would trigger the zoom in again
  function moveOutOfDetectionZone(left_bound, right_bound, bottom_bound) {
    // the following conditionals essentially check which direction the character
    // approached the item that caused it to zoom in; these checks will require
    // the user to only press 'ESCAPE' once when they want to close the window

    if (char_y_pos <= bottom_bound && char_y_pos + char_speed > bottom_bound) {
      // came from bottom
      char_y_pos += char_speed;
    } else if (char_x_pos >= left_bound && char_x_pos - char_speed < left_bound) {
      // came from left
      char_x_pos -= char_speed;
    } else if (char_x_pos <= right_bound && char_x_pos + char_speed > right_bound) {
      // came from right
      char_x_pos += char_speed;
    }
    
    // conditionals for items that have a top bound
    if (is_computer_scene && char_y_pos >= computer_top_bound && char_y_pos - char_speed < computer_top_bound) {
      char_y_pos -= char_speed;
    } else if (is_combo_lock_scene && char_y_pos >= combo_lock_top_bound && char_y_pos - char_speed < combo_lock_top_bound) {
      char_y_pos -= char_speed;
    }
  }


  // initial loading and drawing of background
  function loadBackground(img_url) {
    const background_img = new Image();
    background_img.src = img_url;

    // load images first
    // - Note: the following line is needed to fix the problem of the background img not always
    // displaying when the page is refreshed
    // - Source: https://stackoverflow.com/questions/22889641/simple-html5-canvas-image-not-displaying
    background_img.addEventListener("load", drawBackground, false);

    console.log("loaded")

    function drawBackground() {
      console.log("drawing")

      // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
      // game_context.drawImage(background_img, sx=0, sy=0, swidth=700, sheight=500);
      
      // draw(background_img, 0, 0, 700, 500)  // might not need...?

      console.log("finished")
    }

    return background_img;
    console.log("DRAWN");
  }


  // general function to initially load and draw components (i.e. character)
  function loadCharacter(img_url, x, y, width, height) {
    const img = new Image();
    img.src = img_url;

    // load images first
    // - Note: the following line is needed to fix the problem of the background img not always
    // displaying when the page is refreshed
    // - Source: https://stackoverflow.com/questions/22889641/simple-html5-canvas-image-not-displaying
    img.addEventListener("load", drawCharacter, false); 

    function drawCharacter() {
      // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
      // game_context.drawImage(img, sx=x, sy=y, swidth=width, sheight=height);
      
      // draw(img, x, y, width, height);  // might not need...?
    }

    return img;
  }


  // need this function for redrawing images in infinite loop
  function draw(img, x, y, width, height) {
    game_context.drawImage(img, sx=x, sy=y, swidth=width, sheight=height);
  }

  console.log("OUT");


  // Things to consider when incorporating the changing rooms:
  // done - load the background + make corresponding variables 
  // done- add room variables to conditional that prevents character from being drawn
  //   if not in a room
  // done - add room variables to conditional in 'moveCharacter()' function to prevent     
  //   the character's position from updating when zoomed into an item 
  // done- remember to change the 'current_room' variable when the rooms change
  // - if planning on incorporating zoom-ins, don't forget to...
  //   - create constants that represent the bounds
  //   - add the conditional for it to zoom in in the 'zoomInOnItem()' function
  //   - add to the conditional for the 'ESCAPE' key down in the 'logKey()' function
  // done- when determining how to detect when to change the rooms, don't need to 
  //   change any outer bounds (i.e. room bounds), just need to add in bounds
  //   that would represent the doorways (i.e. x or y positions)

  
  function changeRooms() {

    if (scene_pic == bedroom_scene && ((char_y_pos >= 125 && char_y_pos <= 205) && char_x_pos <= 5)){
      scene_pic = livingroom_scene;
      current_room = livingroom_scene;
      char_x_pos = 625;
      char_y_pos = 125
      is_bedroom_scene = false;
      is_livingroom_scene = true;
    }

    if (scene_pic == livingroom_scene && ((char_x_pos >= 500 && char_x_pos <= 590) && char_y_pos <= 5) ){
      scene_pic = kitchen_scene;
      current_room = kitchen_scene;
      char_x_pos = 330;
      char_y_pos = 420;
      is_kitchen_scene = true;
      is_livingroom_scene = false;
    }

    if (scene_pic == kitchen_scene && ((char_x_pos >= 280 && char_x_pos <= 380) && char_y_pos >= 430)){
      scene_pic = livingroom_scene;
      current_room = livingroom_scene;
      char_x_pos = 555;
      char_y_pos = 10;
      is_kitchen_scene = false;
      is_livingroom_scene = true;
    }

    if (scene_pic == livingroom_scene && ((char_y_pos >= 107 && char_y_pos <= 160) && char_x_pos >= 630) ){
      scene_pic = bedroom_scene;
      current_room = bedroom_scene;
      char_x_pos = 10;
      char_y_pos = 155;
      is_bedroom_scene = true;
      is_livingroom_scene = false;
    }

  }





  // THIRD ATTEMPT (similar to final attempt)
  // const bedroom_img = new Image();
  // bedroom_img.src = "images/bedroom.png";
  // bedroom_img.onload = () => {
  //   // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
  //   game_context.drawImage(bedroom_img, 0, 0, 700, 500);
  // };



  // SECOND ATTEMPT
  // window.onload = function() {
  //   var canvas = document.getElementById("myCanvas");
  //   var ctx = canvas.getContext("2d");

  //   var gameScene = new Image();
  //   gameScene.src = "images/bedroom.png";
  //   ctx.drawImage(gameScene, 0, 0, 700, 500);
  // };



  // FIRST ATTEMPT
  // function startGame() {
  //     myGameArea.start();
  // }

  // var myGameArea = {
  //     myCanvas : document.createElement("myCanvas"),
  //     start : function() {
  //         // this.myCanvas.width = 700;
  //         // this.myCanvas.height = 500;
  //         this.context = this.myCanvas.getContext("2d");
  //         document.body.insertBefore(this.myCanvas, document.body.childNodes[0]);
  //     }
  // }

</script>

<p>We have created a game area! (or at least an empty canvas)</p>

<!--Add hints or description to bottom-->
  <p id="hintsText">Hints: press ? to get a new hint!</p>
  <br>
  <p id="hintsList"></p>
  <br>
  <div id="tastList">
    <p>Remaining tasks:</p>
    <p id="unlockComputer">- Unlock the computer &#128187</p>
    <p id="makeToast">- Make toast &#127838 </p>
    <p id="openFridge">- Open the fridge &#127859</p>
    <p id="makeCoffee">- Make coffee &#9749</p>
  </div>
  <br>
  <div id="resources">
    <p>Resources</p>
    <p><a href="guides/caesar_ciphers.pdf" target="_blank" rel="noopener noreferrer">On Caesar Ciphers</a></p>
    <p><a href="guides/number_systems_and_ascii.pdf" target="_blank" rel="noopener noreferrer">Number Systems and ASCII</a></p>
    <p><a href="guides/cli.pdf" target="_blank" rel="noopener noreferrer">Navigating a Command-Line Interface</a></p>
  </div>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
<meta charset = "utf-8" name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cybersecurity Breakfast Adventure</title>
<style>
  /* style for entire webpage */
  body {
    background-color: black;
    text-align: center;
    color: white;
    font-family: courier;
  }

  /* style for guide hyperlinks */
  a
  {
    color: rgb(123, 213, 255);
  }

/* this part of the code makes the canvas only show at the top of the page--cannot position it */
/* canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
} */
</style>
<!-- <link rel="stylesheet" href="css/alt.css"> -->
</head>
  <h2>Cybersecurity Breakfast Adventure</h2>
  <h3>*For the best user experience, please use Mozilla Firefox. The game has experienced some issues in Google Chrome and Safari. If you ever have problems of the character getting stuck in place or the screen going black, please refresh the page. Note that your current progress in the game will be lost when the page is refreshed.*</h3>
<p>Instructions: Use the arrow keys to navigate locations and complete your tasks. If you find yourself at a pop-up screen within the game, press Escape to close it and return to the overworld. For text-based prompts, hit Enter to submit your input.</p>
<!-- creating a canvas: -->
<canvas id="myCanvas" width="700" height="500" style="background-color: #f1f1f1;"></canvas>
<!-- <script src="plugins.js"></script> -->
<br>
<!-- <body onload="startGame()"> -->
<body onload="start()">
<script>
  // get the canvas element and context (context allows you to draw on the canvas)
  const game_canvas = document.getElementById("myCanvas");
  const game_context = game_canvas.getContext("2d");


  // scene attributes
  var scene_pic;

  var is_bedroom_scene = true;

  // character attributes
  var char_pic;

  var char_x_pos = 587;  // x pos of top left corner of char img
  var char_y_pos = 282;  // y pos of top left corner of char img

  const char_speed = 5;

  var is_key_up = false;
  var is_key_right = false;
  var is_key_down = false;
  var is_key_left = false;



  // FINAL ATTEMPT (SUCCESSFUL!!)
  console.log("BEGIN");

  // begins game
  function start() {
    console.log("starting")

    // load initial components (i.e. game setting and character)
    loadBackground();
    loadCharacter("images/step1.png", char_x_pos, char_y_pos, 64, 64);
    
    setInterval(update, 20)  // infinite loop, runs every 2 ms

    console.log("ending")
  }


  // updates game visuals and stats
  function update() {
    // step 1 - clear the canvas
    clearCanvas();

    // step 2 - update character position
    moveCharacter();

    // step 3 - redraw
    draw(scene_pic, 0, 0, 700, 500);
    draw(char_pic, char_x_pos, char_y_pos, 64, 64);

    console.log("CLEARED")
  }


  // clears canvas
  function clearCanvas() {
    // clears everything on the canvas
    game_context.clearRect(0, 0, 700, 500);
  }


  // moves character
  function moveCharacter() {
    // move up
    if (is_key_up && (char_y_pos - char_speed > 0) && (char_y_pos - char_speed <= 436)) {
      char_y_pos -= char_speed;
    }

    // move right
    if (is_key_right && (char_x_pos + char_speed > 0) && (char_x_pos + char_speed <= 636)) {
      char_x_pos += char_speed;
    }

    // move down
    if (is_key_down && (char_y_pos + char_speed > 0) && (char_y_pos + char_speed <= 436)) {
      char_y_pos += char_speed;
    }

    // move left
    if (is_key_left && (char_x_pos - char_speed > 0) && (char_x_pos - char_speed <= 636)) {
      char_x_pos -= char_speed;
    }
  }


  // record key downs (specifically character movements)
  // source: https://stackoverflow.com/questions/39806858/how-to-use-arrow-keys-to-move-object-smoothly-in-canvas
  document.onkeydown = function(event) {
    if (event.code === "ArrowUp") {
      is_key_up = true;
    }

    if (event.code === "ArrowRight") {
      is_key_right = true;
    }

    if (event.code === "ArrowDown") {
      is_key_down = true;
    }

    if (event.code === "ArrowLeft") {
      is_key_left = true;
    }
  }

  document.onkeyup = function(event) {
    if (event.code === "ArrowUp") {
      is_key_up = false;
    }

    if (event.code === "ArrowRight") {
      is_key_right = false;
    }

    if (event.code === "ArrowDown") {
      is_key_down = false;
    }

    if (event.code === "ArrowLeft") {
      is_key_left = false;
    }
  }


  // initial loading and drawing of background
  function loadBackground() {
    const background_img = new Image();

    if (is_bedroom_scene) {
      background_img.src = "images/bedroom.png";
    }

    // load images first
    // - Note: the following line is needed to fix the problem of the background img not always
    // displaying when the page is refreshed
    // - Source: https://stackoverflow.com/questions/22889641/simple-html5-canvas-image-not-displaying
    background_img.addEventListener("load", drawBackground, false);

    console.log("loaded")

    function drawBackground() {
      console.log("drawing")

      // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
      // game_context.drawImage(background_img, sx=0, sy=0, swidth=700, sheight=500);
      draw(background_img, 0, 0, 700, 500)

      console.log("finished")
    }

    // update current scene pic
    scene_pic = background_img;
    console.log("DRAWN");
  }


  // general function to initially load and draw components (i.e. character)
  function loadCharacter(img_url, x, y, width, height) {
    const img = new Image();
    img.src = img_url;

    // load images first
    // - Note: the following line is needed to fix the problem of the background img not always
    // displaying when the page is refreshed
    // - Source: https://stackoverflow.com/questions/22889641/simple-html5-canvas-image-not-displaying
    img.addEventListener("load", drawCharacter, false); 

    function drawCharacter() {
      // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
      // game_context.drawImage(img, sx=x, sy=y, swidth=width, sheight=height);
      draw(img, x, y, width, height);
    }

    // update current character pic
    char_pic = img;
  }


  // need this function for redrawing images in infinite loop
  function draw(img, x, y, width, height) {
    game_context.drawImage(img, sx=x, sy=y, swidth=width, sheight=height);
  }

  console.log("OUT");






  // THIRD ATTEMPT (similar to final attempt)
  // const bedroom_img = new Image();
  // bedroom_img.src = "images/bedroom.png";
  // bedroom_img.onload = () => {
  //   // parameters of drawImage: image, x-coord-of-img, y-coord-of-img, img-width, img-height
  //   game_context.drawImage(bedroom_img, 0, 0, 700, 500);
  // };



  // SECOND ATTEMPT
  // window.onload = function() {
  //   var canvas = document.getElementById("myCanvas");
  //   var ctx = canvas.getContext("2d");

  //   var gameScene = new Image();
  //   gameScene.src = "images/bedroom.png";
  //   ctx.drawImage(gameScene, 0, 0, 700, 500);
  // };



  // FIRST ATTEMPT
  // function startGame() {
  //     myGameArea.start();
  // }

  // var myGameArea = {
  //     myCanvas : document.createElement("myCanvas"),
  //     start : function() {
  //         // this.myCanvas.width = 700;
  //         // this.myCanvas.height = 500;
  //         this.context = this.myCanvas.getContext("2d");
  //         document.body.insertBefore(this.myCanvas, document.body.childNodes[0]);
  //     }
  // }

</script>

<p>We have created a game area! (or at least an empty canvas)</p>

<!--Add hints or description to bottom-->
  <p id="hintsText">Hints: press ? to get a new hint!</p>
  <br>
  <p id="hintsList"></p>
  <br>
  <div id="tastList">
    <p>Remaining tasks:</p>
    <p id="unlockComputer">- Unlock the computer &#128187</p>
    <p id="makeToast">- Make toast &#127838 </p>
    <p id="openFridge">- Open the fridge &#127859</p>
    <p id="makeCoffee">- Make coffee &#9749</p>
  </div>
  <br>
  <div id="resources">
    <p>Resources</p>
    <p><a href="guides/caesar_ciphers.pdf" target="_blank" rel="noopener noreferrer">On Caesar Ciphers</a></p>
    <p><a href="guides/number_systems_and_ascii.pdf" target="_blank" rel="noopener noreferrer">Number Systems and ASCII</a></p>
    <p><a href="guides/cli.pdf" target="_blank" rel="noopener noreferrer">Navigating a Command-Line Interface</a></p>
  </div>

</body>
</html>